<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>On Advanced Task Killer &#8211; Tadej's Blog</title>
<meta name="description" content="There’s not a single Android enthusiast that doesn’t know the Advanced Task Killer app. But how does it work and what does it actually do?">
<meta name="keywords" content="android, task killer, memory">



<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="On Advanced Task Killer">
<meta property="og:description" content="There’s not a single Android enthusiast that doesn’t know the Advanced Task Killer app. But how does it work and what does it actually do?">
<meta property="og:url" content="/on-advanced-task-killer/">
<meta property="og:site_name" content="Tadej's Blog">





<link rel="canonical" href="/on-advanced-task-killer/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Tadej's Blog Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<!-- Webfonts -->
<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">



</head>

<body id="post" >

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
    <button class="dl-trigger">Open Menu</button>

    <ul class="dl-menu">
        
        <li>
            <a href="/">Home</a>
        </li>

        <li>
            <a href="/about/">About</a>
        </li>

        <li>
            <a href="/posts/">Posts</a>
        </li>

        <li>
            <a href="/projects/">Projects</a>
        </li>

        
        <li>
            <a href="http://linkedin.com/in/tadejslamic"><i class="fa fa-fw fa-linkedin"></i> LinkedIn</a>
        </li>
        

        
        <li>
            <a href="http://github.com/tslamic"><i class="fa fa-fw fa-github"></i> GitHub</a>
        </li>
        
        
        
        <li>
            <a href="http://stackoverflow.com/users/905349/curtisloew"><i class="fa fa-fw fa-stack-exchange"></i> Stack Overflow</a>
        </li>
        

    </ul>
    
</nav>




<div id="main" role="main">
  <article class="hentry">
    <header class="header-title">
      <div class="header-title-wrap">
        
          <h1 class="entry-title"><a href="/on-advanced-task-killer/" rel="bookmark" title="On Advanced Task Killer">On Advanced Task Killer</a></h1>
        
        <h2><span class="entry-date date published"><time datetime="2015-03-01T00:00:00-05:00">March 01, 2015</time></span></h2>
        
        <p class="entry-reading-time">
          <i class="fa fa-clock-o"></i>
          
          Reading time ~5 minutes
        </p><!-- /.entry-reading-time -->
        
      </div><!-- /.header-title-wrap -->
    </header>
    <div class="entry-content">
      <p>There’s not a single Android enthusiast that doesn’t know the Advanced Task Killer app.</p>

<p>It’s supposedly the #1 task management app on Google Play, designed to kill applications and boost memory. Fiddling with system management is generally a bad idea, so I was quite curious what kind of black magic are they doing under the hood. With all the popularity and more than half a million downloads, they must be doing something right. Right?</p>

<p>Firstly, an important question. Why would anyone want to <em>kill</em> an app? I agree with <a href="http://blog.radioactiveyak.com/2010/05/when-to-include-exit-button-in-android.html">Reto Meier</a>:</p>

<blockquote>
<p>… in my experience what users really want is an unambiguous way to guarantee that an app will stop consuming resources (battery, CPU cycles, data transfer, etc). Many perceive that an exit button implements this requirement and ask for it to be added. Developers, looking to please their users, obligingly add one…</p>
</blockquote>

<p>With seamless state restoration, Android (and iOS) apps seem to run forever. They give no real <em>exit</em> notion. Misunderstanding this non-desktop behaviour is, I’m guessing, why apps such as Advanced Task Killer (ATK henceforth) are well received. Few realize Android is clever enough to manage itself much better than we ever will, and there’s no need to interfere. In development world, manual or forced quitting is actually <a href="http://stackoverflow.com/a/2034238/905349">frowned upon</a>, or, as Romain Guy <a href="https://groups.google.com/d/msg/android-developers/G_D3pKnGLt0/0mFuZnjxjP4J">explains:</a> </p>

<blockquote>
<p>… the system handles it automatically. That&#39;s what the Activity lifecycle (especially onPause/onStop/onDestroy) is for. No matter what you do, do not put a &quot;quit&quot; or &quot;exit&quot; application button. It is useless with Android&#39;s application model.</p>
</blockquote>

<p>In reality, quiting could make matters worse. Killed apps might be restarted if they are, for example, receiving system events. Same goes for some services. You esentially force Android to do more work and consume more resources, such as battery life, to achieve absolutely nothing.</p>

<p>With this in mind, it’s fair to speculate ATK is redundant. To see it tick, the initial step is to observe its source. Reversing an apk is, with tools available online, a piece of cake. Given the app feel, I didn’t expect it to be obfuscated. To my surprise, it was. Browsing through, I had to admit defeat - no <code>killProcess</code> invocation anywhere, which I was expecting. At least not explicitly, that is.</p>

<p>For fun (and no profit), let&#39;s try to recreate the app. </p>

<p>First, we need to get a list of all activities currently running. ATK can also extract running services. We&#39;re going to ignore them, but you can try and add them yourself - it&#39;s easy.</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="cm">/*
 * Returns the list of all available launcher Activities.
 */</span>
<span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">ResolveInfo</span><span class="o">&gt;</span> <span class="nf">getAvailableActivityLaunchers</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">PackageManager</span> <span class="n">manager</span> <span class="o">=</span> <span class="n">getPackageManager</span><span class="o">();</span>
    <span class="kd">final</span> <span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="n">Intent</span><span class="o">.</span><span class="na">ACTION_MAIN</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
    <span class="n">intent</span><span class="o">.</span><span class="na">addCategory</span><span class="o">(</span><span class="n">Intent</span><span class="o">.</span><span class="na">CATEGORY_LAUNCHER</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">manager</span><span class="o">.</span><span class="na">queryIntentActivities</span><span class="o">(</span><span class="n">intent</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
<span class="o">}</span></code></pre></div>

<p>Next, we want to filter out the activities currently running, but ignore the ones associated with the system:</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="cm">/*
 * Create a mapping from a process name to its ResolveInfo.
 */</span>
<span class="kd">private</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">ResolveInfo</span><span class="o">&gt;</span> <span class="nf">getAvailableActivityLaunchersMap</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">ResolveInfo</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">getAvailableActivityLaunchers</span><span class="o">();</span>
    <span class="kd">final</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">ResolveInfo</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">ResolveInfo</span><span class="o">&gt;(</span><span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">ResolveInfo</span> <span class="nl">info:</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">info</span><span class="o">.</span><span class="na">activityInfo</span><span class="o">.</span><span class="na">processName</span><span class="o">,</span> <span class="n">info</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">map</span><span class="o">;</span>
<span class="o">}</span>

<span class="cm">/*
 * Return a filtered list of currently running Activities.
 */</span>
<span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">ResolveInfo</span><span class="o">&gt;</span> <span class="nf">getAvailableLaunchersCurrentlyRunning</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">ActivityManager</span> <span class="n">manager</span> <span class="o">=</span> <span class="n">getActivityManager</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
    <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">ResolveInfo</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="n">getAvailableActivityLaunchersMap</span><span class="o">();</span>

    <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">ActivityManager</span><span class="o">.</span><span class="na">RunningAppProcessInfo</span><span class="o">&gt;</span> <span class="n">runningApps</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="na">getRunningAppProcesses</span><span class="o">();</span>
    <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">ResolveInfo</span><span class="o">&gt;</span> <span class="n">available</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">ResolveInfo</span><span class="o">&gt;(</span><span class="n">runningApps</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">ActivityManager</span><span class="o">.</span><span class="na">RunningAppProcessInfo</span> <span class="nl">runningApp:</span> <span class="n">runningApps</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">skip</span><span class="o">(</span><span class="n">runningApp</span><span class="o">))</span> <span class="o">{</span> <span class="c1">// skips system-related Activities</span>
            <span class="kd">final</span> <span class="n">ResolveInfo</span> <span class="n">info</span> <span class="o">=</span> <span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">runningApp</span><span class="o">.</span><span class="na">processName</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">!=</span> <span class="n">info</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">available</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">info</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">available</span><span class="o">;</span>
<span class="o">}</span></code></pre></div>

<p>This is, believe it or not, the gist of ATK. The only thing missing is the ability to <em>kill</em> a selected list item. ATK does it by invoking <code>activityManager.restartPackage(packageName)</code>. Initially, <a href="http://grepcode.com/file/repository.grepcode.com/java/ext/com.google.android/android/2.0_r1/android/app/ActivityManager.java#ActivityManager.restartPackage%28java.lang.String%29">this method</a> had the system perform a force stop of everything associated with the given application package (killed processes with same uid, stopped running services, removed activities, etc). Heavily abused by task killers, it caused all sorts of issues. Android engineers eventually had enough. They&#39;ve changed its behaviour, leaving <a href="https://android.googlesource.com/platform/frameworks/base.git/+/03abb8179f0d912e6dabfc0e2b0f129d85066d17">this comment</a>: </p>

<blockquote>
<p>Kill the task killers. <br/><br/> The <code>ActivityManager.restartPackage()</code> API is now deprecated, and no longer
allows applications to mess up the state of other applications.  This was
being abused by task killers, causing users to think their other applications
had bugs. <br/><br/> A new API is introduced for task killers,
<code>ActivityManager.killBackgroundProcesses()</code>, which allows these applications
to kill processes but only the same amount that the out of memory
killer does, thus causing no permanent damage.  The old <code>restartPackage()</code>
API is now a wrapper for calling this new API.</p>
</blockquote>

<p>From API level 8, calling <code>restartPackage</code> is therefore the same as calling <code>killBackgroundProcesses</code>. Following the source code from, let&#39;s say, <code>ActivityThread.handleLowMemory()</code> which is presumably called when memory becomes tight, we end up in the same method: <code>killPackageProcessesLocked</code>. It&#39;s safe to assume ATK provides the exact same functionality as the system. The only difference is that ATK explicitly selects a package to be killed, whereas the system pick is based on an algorithm. Since the system knows its internals, it&#39;s much better at determining when and what to do when resource management is required. </p>

<p>With this in mind, one could argue ATK is harmless. The real problem is us, killing apps at random, without knowing what they do behind the scenes. We should stop interfeering and our system will run just fine.</p>

<p>To finish off the fake ATK, we: </p>

<ul>
<li>show the <code>getAvailableLaunchersCurrentlyRunning()</code> list in a <code>ListView</code></li>
<li>add a listener that, on item click, triggers the <code>killBackgroundProcesses()</code> method.</li>
</ul>

<p>You can view the complete implementation, with very appealing UI, on <a href="https://github.com/tslamic/AndroidExamples/tree/master/TaskKiller/TaskKiller">Github</a>. In the near future, I plan to write a post about the <em>out-of-memory killer</em>. Some of the topics I&#39;ll touch are already included in the app, so just ignore them for now.</p>

      <footer class="entry-meta">
        <span class="entry-tags"><a href="/tags/#android" title="Pages tagged android" class="tag"><span class="term">android</span></a><a href="/tags/#task killer" title="Pages tagged task killer" class="tag"><span class="term">task killer</span></a><a href="/tags/#memory" title="Pages tagged memory" class="tag"><span class="term">memory</span></a></span>
        
        <div class="social-share">
  <ul class="socialcount socialcount-small inline-list">
    <li class="facebook"><a href="https://www.facebook.com/sharer/sharer.php?u=/on-advanced-task-killer/" title="Share on Facebook"><span class="count"><i class="fa fa-facebook-square"></i> Like</span></a></li>
    <li class="twitter"><a href="https://twitter.com/intent/tweet?text=/on-advanced-task-killer/" title="Share on Twitter"><span class="count"><i class="fa fa-twitter-square"></i> Tweet</span></a></li>
    <li class="googleplus"><a href="https://plus.google.com/share?url=/on-advanced-task-killer/" title="Share on Google Plus"><span class="count"><i class="fa fa-google-plus-square"></i> +1</span></a></li>
  </ul>
</div><!-- /.social-share -->
      </footer>
    </div><!-- /.entry-content -->
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
    <div class="read-more">
  
    <div class="read-more-header">
      <a href="/fancy-background/" class="read-more-btn">Read More</a>
    </div><!-- /.read-more-header -->
    <div class="read-more-content">
      <h3><a href="/builders-and-required-params/" title="Builders and Required Params">Builders and Required Params</a></h3>
      <p>How to handle builders with required parameters <a href="/builders-and-required-params/">Continue reading</a></p>
    </div><!-- /.read-more-content -->
  
  <div class="read-more-list">
    
      <div class="list-item">
        <h4><a href="/creating-android-device-names/" title="Creating AndroidDeviceNames">Creating AndroidDeviceNames</a></h4>
        <span>Published on August 22, 2015</span>
      </div><!-- /.list-item -->
    
      <div class="list-item">
        <h4><a href="/sync-folders-with-python/" title="Sync folders with Python">Sync folders with Python</a></h4>
        <span>Published on May 30, 2015</span>
      </div><!-- /.list-item -->
    
  </div><!-- /.read-more-list -->
</div><!-- /.read-more -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2017 Tadej Slamic. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="http://mademistakes.com/hpstr/" rel="notfollow">HPSTR Theme</a>.</span>
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/scripts.min.js"></script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44812127-1', 'auto');  
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');
</script>



    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'tslamic'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script'); s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
	        

</body>
</html>
