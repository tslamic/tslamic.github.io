<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Creating AndroidDeviceNames &#8211; Tadej's Blog</title>
<meta name="description" content="A story behind AndroidDeviceNames, a tiny Android library that transforms the device model name into something users can understand.">
<meta name="keywords" content="Android">



<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Creating AndroidDeviceNames">
<meta property="og:description" content="A story behind AndroidDeviceNames, a tiny Android library that transforms the device model name into something users can understand.">
<meta property="og:url" content="/creating-android-device-names/">
<meta property="og:site_name" content="Tadej's Blog">





<link rel="canonical" href="/creating-android-device-names/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Tadej's Blog Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<!-- Webfonts -->
<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">



</head>

<body id="post" >

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
    <button class="dl-trigger">Open Menu</button>

    <ul class="dl-menu">
        
        <li>
            <a href="/">Home</a>
        </li>

        <li>
            <a href="/about/">About</a>
        </li>

        <li>
            <a href="/posts/">Posts</a>
        </li>

        <li>
            <a href="/projects/">Projects</a>
        </li>

        
        <li>
            <a href="http://linkedin.com/in/tadejslamic"><i class="fa fa-fw fa-linkedin"></i> LinkedIn</a>
        </li>
        

        
        <li>
            <a href="http://github.com/tslamic"><i class="fa fa-fw fa-github"></i> GitHub</a>
        </li>
        
        
        
        <li>
            <a href="http://stackoverflow.com/users/905349/curtisloew"><i class="fa fa-fw fa-stack-exchange"></i> Stack Overflow</a>
        </li>
        

    </ul>
    
</nav>




<div id="main" role="main">
  <article class="hentry">
    <header class="header-title">
      <div class="header-title-wrap">
        
          <h1 class="entry-title"><a href="/creating-android-device-names/" rel="bookmark" title="Creating AndroidDeviceNames">Creating AndroidDeviceNames</a></h1>
        
        <h2><span class="entry-date date published"><time datetime="2015-08-22T00:00:00-04:00">August 22, 2015</time></span></h2>
        
        <p class="entry-reading-time">
          <i class="fa fa-clock-o"></i>
          
          Reading time ~6 minutes
        </p><!-- /.entry-reading-time -->
        
      </div><!-- /.header-title-wrap -->
    </header>
    <div class="entry-content">
      <p>A few days ago, I open sourced <a href="https://github.com/tslamic/AndroidDeviceNames">AndroidDeviceNames</a>, a tiny Android library that transforms the device model into a user-friendly name.</p>

<p>For example, <code>SM-N910W8</code> becomes <code>Samsung Galaxy Note 4</code> with a simple method call:</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">DeviceNames</span><span class="o">.</span><span class="na">getDeviceName</span><span class="o">(</span><span class="s">"SM-N910W8"</span><span class="o">,</span> <span class="s">"Unknown Device"</span><span class="o">);</span></code></pre></div>

<p>Currently, the library recognises about 400 devices. In case the device is not on the list, the above example returns <code>Unknown Device</code>.</p>

<p>The idea for the library came while working on a side project where I need to show the device name to the user. Obviously, showing <code>SM-N910W8</code> is subpar. Searching for a solution, all I could find online was a somewhat obsolete <a href="https://github.com/meetup/android-device-names">project</a> with a single <code>.properties</code> file containing <code>model = name</code> pairs. I guess the idea is to load the file into a <a href="http://docs.oracle.com/javase/7/docs/api/java/util/Properties.html">Properties</a> object.</p>

<p>I don’t particularly like this. My side project manipulates bitmaps regularly and I’d like to avoid any unnecessary memory overhead. Since <code>Properties</code> extends <code>Hashtable</code>, overhead is expected. Here’s the <a href="https://gist.github.com/tslamic/df10d6c6fb7f654e02bc#file-devicenamesproperties-java">hprof dump</a>:</p>

<p><img src="http://i.imgur.com/tAqPrLO.png" alt="props_hprof_dump" /></p>

<p>It finds the model name in <code>~O(1)</code> time but takes a whopping <code>59 kB</code> of memory to do it. In grand scheme of things, this is no problem for Android, but it can be improved. For instance, we could read the file, line by line and:</p>

<ol>
  <li>discard the pair and continue, if it’s not what we’re looking for, or</li>
  <li>save it to a database, or</li>
  <li>remember the pair in a data structure with hopefully less memory overhead than <code>Properties</code></li>
</ol>

<p>Option 1. will only allocate a constant chunk of memory, i.e. the buffer size, but there’s a high penalty to pay if we plan to search often and with different models, as we have to read the file over and over.</p>

<p>Option 2. is good, but messy. I’d have to be smart about database opening and closing, there’s suddenly more code involved, I might clutter my API, etc. Hopefully I can avoid it.</p>

<p>Could <code>Map</code>, <code>ArrayMap</code> or <code>String[]</code> perform better than <code>Properties</code>? <a href="http://i.imgur.com/bEL3AAh.png">Investigating</a> option 3. produces the following:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: right">Data Structure</th>
      <th style="text-align: center">Retained Heap (kB)</th>
      <th style="text-align: left">Search time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: right"><a href="https://gist.github.com/tslamic/df10d6c6fb7f654e02bc#file-devicenamesmap-java"><code>Map</code></a></td>
      <td style="text-align: center">62</td>
      <td style="text-align: left"><code>~O(1)</code></td>
    </tr>
    <tr>
      <td style="text-align: right"><a href="https://gist.github.com/tslamic/df10d6c6fb7f654e02bc#file-devicenamesarraymap-java"><code>ArrayMap</code></a></td>
      <td style="text-align: center">53</td>
      <td style="text-align: left"><code>O(log)</code></td>
    </tr>
    <tr>
      <td style="text-align: right"><a href="https://gist.github.com/tslamic/df10d6c6fb7f654e02bc#file-devicenamesarray-java"><code>String[]</code></a></td>
      <td style="text-align: center">51</td>
      <td style="text-align: left"><code>O(n)</code></td>
    </tr>
    <tr>
      <td style="text-align: right"><a href="https://gist.github.com/tslamic/df10d6c6fb7f654e02bc#file-devicenamestwoarrays-java"><code>String[], String[]</code></a></td>
      <td style="text-align: center">51</td>
      <td style="text-align: left"><code>O(n)</code></td>
    </tr>
  </tbody>
</table>

<p>Besides a nice insight in memory vs. time tradeoff, there’s still quite a bit of memory involved. It does seem an <code>ArrayMap</code>  represents the middle ground between memory and performance, but <a href="https://www.youtube.com/watch?v=ORgucLTtTDI">watch this</a> before jumping to conclusions.</p>

<p>Can things be improved if we don’t need to be as flexible? For example, if the <code>model-name</code> pairs are embedded in a class as constants and reading a file is not required? Well, it makes <a href="http://i.imgur.com/XC2olUn.png">quite an impact</a>:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: right">Data Structure</th>
      <th style="text-align: center">Retained Heap (kB)</th>
      <th style="text-align: left">Search time</th>
      <th style="text-align: left">Factor</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: right"><code>Map</code></td>
      <td style="text-align: center">14</td>
      <td style="text-align: left"><code>~O(1)</code></td>
      <td style="text-align: left">4</td>
    </tr>
    <tr>
      <td style="text-align: right"><code>ArrayMap</code></td>
      <td style="text-align: center">5</td>
      <td style="text-align: left"><code>O(log)</code></td>
      <td style="text-align: left">10</td>
    </tr>
    <tr>
      <td style="text-align: right"><code>String[]</code></td>
      <td style="text-align: center">3</td>
      <td style="text-align: left"><code>O(n)</code></td>
      <td style="text-align: left">17</td>
    </tr>
    <tr>
      <td style="text-align: right"><code>String[]</code>,<code>String[]</code></td>
      <td style="text-align: center">3</td>
      <td style="text-align: left"><code>O(n)</code></td>
      <td style="text-align: left">17</td>
    </tr>
  </tbody>
</table>

<p>If our goal is to save memory, we should definitely avoid reading files. The factor column shows that, for example, <code>String[]</code> implementation with constants consumes 17x less memory than its file-reading counterpart.</p>

<p>So how do I effectively move the <code>model-name</code> pairs from a file to Java constants, because I’m sure as hell not writing them by hand?</p>

<p>It took me a few minutes to write a simple Python script that reads the <code>model-name</code> file and creates a populated Java data structure for me to copy and paste. Sure, more involved than plain Java, but straightforward.</p>

<p>Sacrificing a bit of flexibility for a memory efficient implementation, I could stop here. But would it be possible to eliminate memory overhead completely? This was more of an exploration question, born <em>not out of necessity</em>, but rather curiosity.</p>

<p>I’d have to find a way to eliminate the data structure holding the <code>model-name</code> pairs. A naive but workable approach could be the following:</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">if</span> <span class="o">(</span><span class="s">"ASUS_Transformer_Pad_TF700T"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">model</span><span class="o">))</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">"ASUS Transformer Pad TF700T"</span><span class="o">;</span>
<span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="s">"ASUS_T00J"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">model</span><span class="o">))</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">"Asus ZenFone 5"</span><span class="o">;</span>
<span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="s">"ADR6350"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">model</span><span class="o">))</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">"HTC Droid Incredible 2"</span><span class="o">;</span>
<span class="o">}</span> <span class="c1">// etc.</span></code></pre></div>

<p>Ugly, but with no memory overhead and an <em>okay</em> search performance of <code>O(n)</code>.</p>

<p>I have to be careful though. When a <code>.class</code> file is loaded, it resides in the <a href="https://docs.oracle.com/javase/specs/jvms/se7/html/jvms-2.html#jvms-2.5">method area</a> of a JVM. The method area is logically part of the heap, so it’s futile trying to avoid overhead if the bytecode occupies the same amount of heap (or more) than a data structure would.</p>

<p>A neat way to look at bytecode is <a href="http://docs.oracle.com/javase/7/docs/technotes/tools/windows/javap.html"><code>javap</code></a>. For example, on <code>Java(TM) SE Runtime Environment (build 1.7.0_79-b15)</code>, compiling</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Hello</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Hello World"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div>

<p>then invoking <code>javap -c Hello</code> produces</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Compiled</span> <span class="n">from</span> <span class="s">"Hello.java"</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Hello</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="nf">Hello</span><span class="o">();</span>
    <span class="nl">Code:</span>
       <span class="mi">0</span><span class="o">:</span> <span class="n">aload_0</span>       
       <span class="mi">1</span><span class="o">:</span> <span class="n">invokespecial</span> <span class="err">#</span><span class="mi">1</span> 
       <span class="mi">4</span><span class="o">:</span> <span class="k">return</span>        

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">[]);</span>
    <span class="nl">Code:</span>
       <span class="mi">0</span><span class="o">:</span> <span class="n">getstatic</span>     <span class="err">#</span><span class="mi">2</span>                 
       <span class="mi">3</span><span class="o">:</span> <span class="n">ldc</span>           <span class="err">#</span><span class="mi">3</span>
       <span class="mi">5</span><span class="o">:</span> <span class="n">invokevirtual</span> <span class="err">#</span><span class="mi">4</span>
       <span class="mi">8</span><span class="o">:</span> <span class="k">return</span>        
<span class="o">}</span></code></pre></div>

<p>Each bytecode instruction consists of 1 byte, plus a fixed number of operand bytes. <code>-c</code> flag ensures the output includes byte offsets for each instruction. Therefore, the method size is roughly the same as the last byte offset. Above, <code>main</code> method size is 8 bytes, as this is the offset at the last instruction: <code>8: return</code>.</p>

<p>Extending the Python script, I now generate a simple Java method, <code>getDeviceName</code>, which includes the <code>if-else</code> comparisons. I need to ensure that:</p>

<ul>
  <li>the generated method size <code>mG</code> is smaller then the method size <code>mD</code> querying a data structure plus the total data structure memory, <code>sD</code>.</li>
  <li><code>mG</code> size is less than <a href="http://docs.oracle.com/javase/specs/jvms/se7/html/jvms-4.html#jvms-4.9.1">65536 bytes</a></li>
</ul>

<p>Benchmarking against the least consuming data structure, <code>String[]</code> gives</p>

<table>
  <thead>
    <tr>
      <th style="text-align: right">File</th>
      <th style="text-align: center">Bytecode</th>
      <th style="text-align: center">Bytecode Size</th>
      <th style="text-align: center">Memory</th>
      <th style="text-align: center">Total</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: right"><code>String[]</code></td>
      <td style="text-align: center"><a href="https://gist.github.com/tslamic/df10d6c6fb7f654e02bc#file-devicenamesarraynofile-bytecode">bytecode</a></td>
      <td style="text-align: center">75 + 6233</td>
      <td style="text-align: center">3416</td>
      <td style="text-align: center">9724</td>
    </tr>
    <tr>
      <td style="text-align: right"><code>Generated</code></td>
      <td style="text-align: center"><a href="https://gist.github.com/tslamic/df10d6c6fb7f654e02bc#file-devicenames-bytecode">bytecode</a></td>
      <td style="text-align: center">5691</td>
      <td style="text-align: center">0</td>
      <td style="text-align: center">5691</td>
    </tr>
  </tbody>
</table>

<p>The generated file is a clear winner and passes the two requirements with flying colors. The only thing left to worry about is the search time. Being <code>O(n)</code>, it might prove to be unsatisfactory.</p>

<p>A quick and simple optimization we can do right away is simple branching: taking the first model letter and compare it only against the models with the same starting letter. We’re still stuck in <code>O(n)</code>, but for example, instead of 361 comparisons to get to <code>SPH-D600</code>, we now only do 61, which is about 6 times less.</p>

<p>Empirically, I’d like to see the worst case run below 16 milliseconds. And playing around with <em>Traceview</em>, the average running time is well below 5 milliseconds, which makes me at ease using the generated <code>.java</code> file in my side project.</p>


      <footer class="entry-meta">
        <span class="entry-tags"><a href="/tags/#Android" title="Pages tagged Android" class="tag"><span class="term">Android</span></a></span>
        
        <div class="social-share">
  <ul class="socialcount socialcount-small inline-list">
    <li class="facebook"><a href="https://www.facebook.com/sharer/sharer.php?u=/creating-android-device-names/" title="Share on Facebook"><span class="count"><i class="fa fa-facebook-square"></i> Like</span></a></li>
    <li class="twitter"><a href="https://twitter.com/intent/tweet?text=/creating-android-device-names/" title="Share on Twitter"><span class="count"><i class="fa fa-twitter-square"></i> Tweet</span></a></li>
    <li class="googleplus"><a href="https://plus.google.com/share?url=/creating-android-device-names/" title="Share on Google Plus"><span class="count"><i class="fa fa-google-plus-square"></i> +1</span></a></li>
  </ul>
</div><!-- /.social-share -->
      </footer>
    </div><!-- /.entry-content -->
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
    <div class="read-more">
  
    <div class="read-more-header">
      <a href="/sync-folders-with-python/" class="read-more-btn">Read More</a>
    </div><!-- /.read-more-header -->
    <div class="read-more-content">
      <h3><a href="/builders-and-required-params/" title="Builders and required params">Builders and required params</a></h3>
      <p>How to handle builders with required parameters <a href="/builders-and-required-params/">Continue reading</a></p>
    </div><!-- /.read-more-content -->
  
  <div class="read-more-list">
    
      <div class="list-item">
        <h4><a href="/sync-folders-with-python/" title="Sync folders with Python">Sync folders with Python</a></h4>
        <span>Published on May 30, 2015</span>
      </div><!-- /.list-item -->
    
      <div class="list-item">
        <h4><a href="/android-menu-icon/" title="Android menu icon, delightfully">Android menu icon, delightfully</a></h4>
        <span>Published on April 11, 2015</span>
      </div><!-- /.list-item -->
    
  </div><!-- /.read-more-list -->
</div><!-- /.read-more -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2017 Tadej Slamic. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="http://mademistakes.com/hpstr/" rel="notfollow">HPSTR Theme</a>.</span>
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/scripts.min.js"></script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44812127-1', 'auto');  
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');
</script>



    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'tslamic'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script'); s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
	        

</body>
</html>
