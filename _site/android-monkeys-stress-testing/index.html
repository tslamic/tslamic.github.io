<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Android, monkeys and stress testing &#8211; Tadej's Blog</title>
<meta name="description" content="Android - or, more precisely, its debug bridge - has a very handy tool called the monkey. Its purpose is to stress-test your app by generating pseudo-random user events in a repeatable manner. Sometimes, the usage is a bit clunky or unclear. Enter Dumpey.">
<meta name="keywords" content="android, monkey, memory, automation, dumpey">



<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Android, monkeys and stress testing">
<meta property="og:description" content="Android - or, more precisely, its debug bridge - has a very handy tool called the monkey. Its purpose is to stress-test your app by generating pseudo-random user events in a repeatable manner. Sometimes, the usage is a bit clunky or unclear. Enter Dumpey.">
<meta property="og:url" content="/android-monkeys-stress-testing/">
<meta property="og:site_name" content="Tadej's Blog">





<link rel="canonical" href="/android-monkeys-stress-testing/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Tadej's Blog Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<!-- Webfonts -->
<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">



</head>

<body id="post" >

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
    <button class="dl-trigger">Open Menu</button>

    <ul class="dl-menu">
        
        <li>
            <a href="/">Home</a>
        </li>

        <li>
            <a href="/about/">About</a>
        </li>

        <li>
            <a href="/posts/">Posts</a>
        </li>

        <li>
            <a href="/projects/">Side Projects</a>
        </li>

        
        <li>
            <a href="http://linkedin.com/in/tadejslamic"><i class="fa fa-fw fa-linkedin"></i> LinkedIn</a>
        </li>
        

        
        <li>
            <a href="http://github.com/tslamic"><i class="fa fa-fw fa-github"></i> GitHub</a>
        </li>
        
        
        
        <li>
            <a href="http://stackoverflow.com/users/905349/curtisloew"><i class="fa fa-fw fa-stack-exchange"></i> Stack Overflow</a>
        </li>
        

    </ul>
    
</nav>




<div id="main" role="main">
  <article class="hentry">
    <header class="header-title">
      <div class="header-title-wrap">
        
          <h1 class="entry-title"><a href="/android-monkeys-stress-testing/" rel="bookmark" title="Android, monkeys and stress testing">Android, monkeys and stress testing</a></h1>
        
        <h2><span class="entry-date date published"><time datetime="2015-02-08T00:00:00-05:00">February 08, 2015</time></span></h2>
        
        <p class="entry-reading-time">
          <i class="fa fa-clock-o"></i>
          
          Reading time ~3 minutes
        </p><!-- /.entry-reading-time -->
        
      </div><!-- /.header-title-wrap -->
    </header>
    <div class="entry-content">
      <p>As end users, we’re terrible.</p>

<p>We’ll microwave a fork, pull doors with a big red sign saying push and sue a company for serving us a hot cup of coffee. We’ll grab a supposedly waterproof phone and toss it in a full tub. Then we’ll go online and laugh at the schmuck trying to drill through a wall he’s standing on.</p>

<center>
  <figure>
    <img src="http://i.imgur.com/X17puIB.gif" />
    <figcaption>Can you imagine designing a product that can handle such superusers? </figcaption>
  </figure>
</center>

<p>Creating software with good user experience is hard. Relying on intuition is naive, but expecting a product to be used in a predictable (or, y’know, logical) manner is just wrong.</p>

<p><em>Stress testing</em> puts great emphasis on availability and error handling, under a load few consider normal. It indicates just how robust our product really is.</p>

<p>Android - or, more precisely, its debug bridge -  has a very handy tool called <em>the monkey</em>. It’s purpose is to stress-test your app by generating pseudo-random user events in a repeatable manner. It’s as if a monkey was ordered to test your app. It’ll tap, swipe, click and drag no matter what’s on the screen.</p>

<p>A typical command to start the monkey is:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>adb shell monkey -p your.package.name 5000</code></pre></div>

<p>where <code>-p</code> denotes your package name. <code>5000</code> is the amount of events generated.</p>

<p>Another useful option is the seed parameter. If you re-run the monkey with the same seed value, it will generate the exact same sequence of events. Just add the <code>-s &lt;number&gt;</code> option to your command:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>adb shell monkey -p your.package.name -s 12345 5000</code></pre></div>

<p>This is handy when you encounter crashes while using the monkey. Apply the fix, re-run the monkey with the same seed value and validate.</p>

<p>Sometimes, you’ll have multiple devices to run the monkey on. Suppose <code>adb devices</code> yields</p>

<pre>
List of devices attached 
192.168.56.102:5555		device
0749e0c421157449		device
017961c7d19f9615		device
</pre>

<p>Executing any adb shell command results in <code>error: more than one device and emulator</code>. You need to explicitly tell the adb which device or emulator one to use, by using <code>-s &lt;serialNumber&gt;</code> option:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>adb -s 192.168.56.102:5555 shell monkey -p your.package.name -s 12345 5000</code></pre></div>

<p>This will run the monkey on a device or emulator with a serial number <code>192.168.56.102:5555</code>. To run the monkey on all attached emulators and devices, you have to execute a separate command for each one.</p>

<p>Numerous other options are <a href="http://developer.android.com/tools/help/monkey.html">available</a> to fine-tune the monkey. Perhaps <code>--hprof</code> is an option worth mentioning. If set, it dumps the heap immediately before and after running. This can be quite useful for memory profiling.</p>

<p>However, according to this <a href="http://stackoverflow.com/a/8433740/905349">old post</a>, the <code>--hprof</code> option seems to be ignored. Moreover, the dumps are put in <code>data/misc</code> folder. It may be impossible to extract them.</p>

<p>To tackle the two problems, running the monkey on multiple devices and making heap dumps, I’ve created Dumpey, a collection of (currently) three UNIX scripts:</p>

<ul>
  <li><code>monkey</code> capable of running the monkey on all attached devices/emulators</li>
  <li><code>memdmp</code> capable of extracting and converting heap dumps from a device/emulator to a local drive</li>
  <li><code>dumpey</code> capable of extracting and converting heap dumps before and after running the monkey, on all attached devices/emulators</li>
</ul>

<p>Using Dumpey is easy. For example</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>./monkey -p your.package.name -s 12345 -e 5000</code></pre></div>

<p>runs the monkey on all attached devices with a seed number <code>12345</code>, generating <code>5000</code> random events.</p>

<p>To avoid using DDMS to do a heap dump, use <code>memdmp</code>:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>./memdmp -s SH48HWM03500 -p your.package.name -f heapdumps/my_heap_dump.hprof</code></pre></div>

<p>This will extract a converted memory heap dump to <code>heapdumps/my_heap_dump.hprof</code> file. All you have to do is open it with MAT.</p>

<p>Combine memory dumps and monkey with <code>dumpey</code>:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>./dumpey -p your.package.name -bad heapdumps/</code></pre></div>

<p>This extracts converted memory heap dumps, runs the monkey, and extracts converted memory heap dumps again. It does this on all attached devices or emulators. If, for example, you only have one device attached, <code>SH48HWM03500</code>, then running <code>dumpey</code> with the above command will generate two files in <code>heapdumps</code> folder:</p>

<ul>
  <li><code>SH48HWM03500-before.hprof</code></li>
  <li><code>SH48HWM03500-after.hprof</code></li>
</ul>

<p>As the names suggest, they are converted memory heap dumps from a specific device done before and after running the monkey. Again, all you have to do is open them in MAT.</p>

<p>To read more about Dumpey, visit the <a href="https://github.com/tslamic/Dumpey">Github repo</a>. Happy stress testing!</p>

      <footer class="entry-meta">
        <span class="entry-tags"><a href="/tags/#android" title="Pages tagged android" class="tag"><span class="term">android</span></a><a href="/tags/#monkey" title="Pages tagged monkey" class="tag"><span class="term">monkey</span></a><a href="/tags/#memory" title="Pages tagged memory" class="tag"><span class="term">memory</span></a><a href="/tags/#automation" title="Pages tagged automation" class="tag"><span class="term">automation</span></a><a href="/tags/#dumpey" title="Pages tagged dumpey" class="tag"><span class="term">dumpey</span></a></span>
        
        <div class="social-share">
  <ul class="socialcount socialcount-small inline-list">
    <li class="facebook"><a href="https://www.facebook.com/sharer/sharer.php?u=/android-monkeys-stress-testing/" title="Share on Facebook"><span class="count"><i class="fa fa-facebook-square"></i> Like</span></a></li>
    <li class="twitter"><a href="https://twitter.com/intent/tweet?text=/android-monkeys-stress-testing/" title="Share on Twitter"><span class="count"><i class="fa fa-twitter-square"></i> Tweet</span></a></li>
    <li class="googleplus"><a href="https://plus.google.com/share?url=/android-monkeys-stress-testing/" title="Share on Google Plus"><span class="count"><i class="fa fa-google-plus-square"></i> +1</span></a></li>
  </ul>
</div><!-- /.social-share -->
      </footer>
    </div><!-- /.entry-content -->
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
    <div class="read-more">
  
    <div class="read-more-header">
      <a href="/leaving-london/" class="read-more-btn">Read More</a>
    </div><!-- /.read-more-header -->
    <div class="read-more-content">
      <h3><a href="/creating-android-device-names/" title="Creating AndroidDeviceNames">Creating AndroidDeviceNames</a></h3>
      <p>A story behind AndroidDeviceNames, a tiny Android library that transforms the device model name into something users can understand. <a href="/creating-android-device-names/">Continue reading</a></p>
    </div><!-- /.read-more-content -->
  
  <div class="read-more-list">
    
      <div class="list-item">
        <h4><a href="/sync-folders-with-python/" title="Sync folders with Python">Sync folders with Python</a></h4>
        <span>Published on May 30, 2015</span>
      </div><!-- /.list-item -->
    
      <div class="list-item">
        <h4><a href="/android-menu-icon/" title="Android menu icon, delightfully">Android menu icon, delightfully</a></h4>
        <span>Published on April 11, 2015</span>
      </div><!-- /.list-item -->
    
  </div><!-- /.read-more-list -->
</div><!-- /.read-more -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2017 Tadej Slamic. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="http://mademistakes.com/hpstr/" rel="notfollow">HPSTR Theme</a>.</span>
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/scripts.min.js"></script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44812127-1', 'auto');  
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');
</script>



    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'tslamic'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script'); s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
	        

</body>
</html>
